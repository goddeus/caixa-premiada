// üîç AN√ÅLISE DETALHADA DO FLUXO DE COMPRA - SLOTBOX
// Cole este c√≥digo no console do navegador (F12) em uma p√°gina de caixa espec√≠fica

console.log('üîç INICIANDO AN√ÅLISE DETALHADA DO FLUXO DE COMPRA...');

// ===== AN√ÅLISE 1: VERIFICAR ESTRUTURA DA P√ÅGINA =====
function analisarEstruturaPagina() {
  console.log('\nüìã === ESTRUTURA DA P√ÅGINA ===');
  
  // Verificar se estamos em uma p√°gina de caixa
  const rotaAtual = window.location.pathname;
  console.log(`üìç Rota atual: ${rotaAtual}`);
  
  if (!rotaAtual.includes('case')) {
    console.log('‚ö†Ô∏è N√£o estamos em uma p√°gina de caixa');
    console.log('üí° Navegue para uma p√°gina de caixa primeiro');
    return false;
  }
  
  console.log('‚úÖ Estamos em uma p√°gina de caixa');
  
  // Analisar estrutura HTML
  const elementos = {
    botoes: document.querySelectorAll('button'),
    inputs: document.querySelectorAll('input'),
    selects: document.querySelectorAll('select'),
    divs: document.querySelectorAll('div'),
    spans: document.querySelectorAll('span'),
    imgs: document.querySelectorAll('img')
  };
  
  console.log('üìä Elementos encontrados:');
  Object.entries(elementos).forEach(([tipo, lista]) => {
    console.log(`   - ${tipo}: ${lista.length}`);
  });
  
  return true;
}

// ===== AN√ÅLISE 2: VERIFICAR BOT√ÉO DE ABRIR CAIXA =====
function analisarBotaoAbrirCaixa() {
  console.log('\nüîò === AN√ÅLISE DO BOT√ÉO DE ABRIR CAIXA ===');
  
  const botoes = document.querySelectorAll('button, [class*="button"], [class*="btn"]');
  console.log(`üîò Total de bot√µes: ${botoes.length}`);
  
  let botaoAbrirCaixa = null;
  const botoesRelevantes = [];
  
  botoes.forEach((botao, index) => {
    const texto = botao.textContent?.toLowerCase().trim() || '';
    const classes = botao.className?.toLowerCase() || '';
    const id = botao.id?.toLowerCase() || '';
    
    // Verificar se √© um bot√£o relevante
    if (texto.includes('abrir') || 
        texto.includes('open') || 
        texto.includes('comprar') || 
        texto.includes('buy') ||
        texto.includes('caixa') ||
        texto.includes('case') ||
        classes.includes('open') ||
        classes.includes('buy') ||
        classes.includes('purchase') ||
        id.includes('open') ||
        id.includes('buy')) {
      
      botoesRelevantes.push({
        elemento: botao,
        texto: texto,
        classes: classes,
        id: id,
        index: index
      });
      
      console.log(`   ‚úÖ Bot√£o relevante ${index + 1}: "${texto}"`);
      console.log(`      - Classes: ${classes}`);
      console.log(`      - ID: ${id}`);
      console.log(`      - onClick: ${botao.onclick ? 'Presente' : 'Ausente'}`);
      
      if (texto.includes('abrir') || texto.includes('open')) {
        botaoAbrirCaixa = botao;
      }
    }
  });
  
  console.log(`üéØ Bot√µes relevantes encontrados: ${botoesRelevantes.length}`);
  
  if (botaoAbrirCaixa) {
    console.log('‚úÖ Bot√£o "Abrir Caixa" identificado');
    
    // Analisar o bot√£o em detalhes
    console.log('üîç An√°lise detalhada do bot√£o:');
    console.log(`   - Texto: "${botaoAbrirCaixa.textContent}"`);
    console.log(`   - Classes: "${botaoAbrirCaixa.className}"`);
    console.log(`   - ID: "${botaoAbrirCaixa.id}"`);
    console.log(`   - Disabled: ${botaoAbrirCaixa.disabled}`);
    console.log(`   - onClick: ${botaoAbrirCaixa.onclick ? 'Presente' : 'Ausente'}`);
    
    if (botaoAbrirCaixa.onclick) {
      console.log(`   - Fun√ß√£o onClick: ${botaoAbrirCaixa.onclick.toString().substring(0, 200)}...`);
    }
  } else {
    console.log('‚ùå Bot√£o "Abrir Caixa" n√£o encontrado');
  }
  
  return {
    botaoAbrirCaixa,
    botoesRelevantes
  };
}

// ===== AN√ÅLISE 3: VERIFICAR INFORMA√á√ïES DE PRE√áO =====
function analisarInformacoesPreco() {
  console.log('\nüí∞ === AN√ÅLISE DAS INFORMA√á√ïES DE PRE√áO ===');
  
  // Procurar por elementos que contenham pre√ßo
  const elementosPreco = [];
  
  // Procurar por texto que contenha R$, $, ou n√∫meros
  const todosElementos = document.querySelectorAll('*');
  todosElementos.forEach(elemento => {
    const texto = elemento.textContent?.trim() || '';
    if (texto.match(/R\$\s*\d+|\$\s*\d+|\d+,\d+|\d+\.\d+/)) {
      elementosPreco.push({
        elemento: elemento,
        texto: texto,
        tagName: elemento.tagName,
        classes: elemento.className
      });
    }
  });
  
  console.log(`üí∞ Elementos com pre√ßo encontrados: ${elementosPreco.length}`);
  
  elementosPreco.forEach((item, index) => {
    console.log(`   ${index + 1}. "${item.texto}" (${item.tagName})`);
    if (item.classes) {
      console.log(`      Classes: ${item.classes}`);
    }
  });
  
  // Procurar especificamente por pre√ßo da caixa
  let precoCaixa = null;
  elementosPreco.forEach(item => {
    if (item.texto.includes('R$') && !item.texto.includes('saldo')) {
      precoCaixa = item;
    }
  });
  
  if (precoCaixa) {
    console.log('‚úÖ Pre√ßo da caixa identificado:');
    console.log(`   - Valor: ${precoCaixa.texto}`);
    console.log(`   - Elemento: ${precoCaixa.tagName}`);
    console.log(`   - Classes: ${precoCaixa.classes}`);
  } else {
    console.log('‚ùå Pre√ßo da caixa n√£o encontrado');
  }
  
  return {
    elementosPreco,
    precoCaixa
  };
}

// ===== AN√ÅLISE 4: VERIFICAR SALDO DO USU√ÅRIO =====
function analisarSaldoUsuario() {
  console.log('\nüí≥ === AN√ÅLISE DO SALDO DO USU√ÅRIO ===');
  
  // Verificar localStorage
  const user = localStorage.getItem('user');
  if (!user) {
    console.log('‚ùå Dados do usu√°rio n√£o encontrados no localStorage');
    return null;
  }
  
  try {
    const userData = JSON.parse(user);
    console.log('üë§ Dados do usu√°rio:');
    console.log(`   - Nome: ${userData.nome}`);
    console.log(`   - Email: ${userData.email}`);
    console.log(`   - Saldo: R$ ${userData.saldo_reais || 0}`);
    console.log(`   - ID: ${userData.id}`);
    
    // Procurar por elementos que mostram o saldo na p√°gina
    const elementosSaldo = [];
    const todosElementos = document.querySelectorAll('*');
    
    todosElementos.forEach(elemento => {
      const texto = elemento.textContent?.trim() || '';
      if (texto.includes('saldo') || texto.includes('balance') || texto.includes('R$')) {
        elementosSaldo.push({
          elemento: elemento,
          texto: texto,
          tagName: elemento.tagName,
          classes: elemento.className
        });
      }
    });
    
    console.log(`üí≥ Elementos de saldo na p√°gina: ${elementosSaldo.length}`);
    elementosSaldo.forEach((item, index) => {
      console.log(`   ${index + 1}. "${item.texto}" (${item.tagName})`);
    });
    
    return {
      userData,
      elementosSaldo
    };
    
  } catch (e) {
    console.log('‚ùå Erro ao analisar dados do usu√°rio:', e.message);
    return null;
  }
}

// ===== AN√ÅLISE 5: VERIFICAR SISTEMA DE PR√äMIOS =====
function analisarSistemaPremios() {
  console.log('\nüéÅ === AN√ÅLISE DO SISTEMA DE PR√äMIOS ===');
  
  // Procurar por elementos de pr√™mio
  const elementosPremio = [];
  const todosElementos = document.querySelectorAll('*');
  
  todosElementos.forEach(elemento => {
    const texto = elemento.textContent?.toLowerCase().trim() || '';
    const classes = elemento.className?.toLowerCase() || '';
    
    if (texto.includes('premio') || 
        texto.includes('prize') || 
        texto.includes('reward') ||
        texto.includes('item') ||
        classes.includes('premio') ||
        classes.includes('prize') ||
        classes.includes('reward') ||
        classes.includes('item')) {
      
      elementosPremio.push({
        elemento: elemento,
        texto: elemento.textContent?.trim() || '',
        classes: elemento.className,
        tagName: elemento.tagName
      });
    }
  });
  
  console.log(`üéÅ Elementos de pr√™mio encontrados: ${elementosPremio.length}`);
  
  elementosPremio.forEach((item, index) => {
    console.log(`   ${index + 1}. "${item.texto}" (${item.tagName})`);
    if (item.classes) {
      console.log(`      Classes: ${item.classes}`);
    }
  });
  
  // Procurar por imagens de pr√™mios
  const imagensPremio = document.querySelectorAll('img');
  const imagensRelevantes = [];
  
  imagensPremio.forEach(img => {
    const src = img.src?.toLowerCase() || '';
    const alt = img.alt?.toLowerCase() || '';
    
    if (src.includes('premio') || 
        src.includes('prize') || 
        src.includes('item') ||
        alt.includes('premio') ||
        alt.includes('prize') ||
        alt.includes('item')) {
      
      imagensRelevantes.push({
        elemento: img,
        src: img.src,
        alt: img.alt
      });
    }
  });
  
  console.log(`üñºÔ∏è Imagens de pr√™mio encontradas: ${imagensRelevantes.length}`);
  imagensRelevantes.forEach((img, index) => {
    console.log(`   ${index + 1}. ${img.src} (alt: ${img.alt})`);
  });
  
  return {
    elementosPremio,
    imagensPremio: imagensRelevantes
  };
}

// ===== AN√ÅLISE 6: VERIFICAR FUN√á√ïES JAVASCRIPT =====
function analisarFuncoesJavaScript() {
  console.log('\nüîß === AN√ÅLISE DAS FUN√á√ïES JAVASCRIPT ===');
  
  // Verificar fun√ß√µes no window
  const funcoesRelevantes = [];
  
  Object.keys(window).forEach(key => {
    if (key.toLowerCase().includes('buy') || 
        key.toLowerCase().includes('purchase') || 
        key.toLowerCase().includes('open') || 
        key.toLowerCase().includes('abrir') ||
        key.toLowerCase().includes('comprar') ||
        key.toLowerCase().includes('debito') ||
        key.toLowerCase().includes('credito') ||
        key.toLowerCase().includes('saldo')) {
      
      funcoesRelevantes.push(key);
    }
  });
  
  console.log(`üîß Fun√ß√µes relevantes encontradas: ${funcoesRelevantes.length}`);
  funcoesRelevantes.forEach(funcao => {
    console.log(`   - ${funcao}`);
  });
  
  // Verificar se h√° React hooks ou componentes
  const reactElements = document.querySelectorAll('[data-reactroot], [data-react-helmet]');
  console.log(`‚öõÔ∏è Elementos React encontrados: ${reactElements.length}`);
  
  // Verificar se h√° estado React
  if (window.React) {
    console.log('‚úÖ React encontrado no window');
  }
  
  if (window.ReactDOM) {
    console.log('‚úÖ ReactDOM encontrado no window');
  }
  
  return {
    funcoesRelevantes,
    reactElements
  };
}

// ===== AN√ÅLISE 7: VERIFICAR EVENTOS DE CLIQUE =====
function analisarEventosClique() {
  console.log('\nüñ±Ô∏è === AN√ÅLISE DOS EVENTOS DE CLIQUE ===');
  
  const botoes = document.querySelectorAll('button, [class*="button"], [class*="btn"]');
  let botoesComEventos = 0;
  
  botoes.forEach((botao, index) => {
    if (botao.onclick) {
      botoesComEventos++;
      console.log(`   Bot√£o ${index + 1} tem onClick: ${botao.onclick.toString().substring(0, 100)}...`);
    }
  });
  
  console.log(`üñ±Ô∏è Bot√µes com eventos de clique: ${botoesComEventos}/${botoes.length}`);
  
  // Verificar se h√° event listeners
  const elementosComListeners = [];
  botoes.forEach(botao => {
    // Verificar se h√° event listeners (aproxima√ß√£o)
    if (botao.onclick || botao.onmousedown || botao.onmouseup) {
      elementosComListeners.push(botao);
    }
  });
  
  console.log(`üéØ Elementos com event listeners: ${elementosComListeners.length}`);
  
  return {
    botoesComEventos,
    elementosComListeners
  };
}

// ===== FUN√á√ÉO PRINCIPAL =====
async function executarAnaliseDetalhada() {
  console.log('üîç EXECUTANDO AN√ÅLISE DETALHADA DO FLUXO DE COMPRA...');
  
  const resultados = {
    timestamp: new Date().toISOString(),
    rotaAtual: window.location.pathname,
    estrutura: null,
    botao: null,
    preco: null,
    saldo: null,
    premios: null,
    funcoes: null,
    eventos: null
  };
  
  try {
    // An√°lise 1: Estrutura da p√°gina
    const estruturaOK = analisarEstruturaPagina();
    if (!estruturaOK) {
      console.log('‚ùå An√°lise interrompida - n√£o estamos em uma p√°gina de caixa');
      return;
    }
    
    // An√°lise 2: Bot√£o de abrir caixa
    resultados.botao = analisarBotaoAbrirCaixa();
    
    // An√°lise 3: Informa√ß√µes de pre√ßo
    resultados.preco = analisarInformacoesPreco();
    
    // An√°lise 4: Saldo do usu√°rio
    resultados.saldo = analisarSaldoUsuario();
    
    // An√°lise 5: Sistema de pr√™mios
    resultados.premios = analisarSistemaPremios();
    
    // An√°lise 6: Fun√ß√µes JavaScript
    resultados.funcoes = analisarFuncoesJavaScript();
    
    // An√°lise 7: Eventos de clique
    resultados.eventos = analisarEventosClique();
    
    // Resumo final
    setTimeout(() => {
      console.log('\nüéØ === RESUMO DA AN√ÅLISE DETALHADA ===');
      
      console.log('üìä INFORMA√á√ïES COLETADAS:');
      console.log(`   - Rota: ${resultados.rotaAtual}`);
      console.log(`   - Bot√£o "Abrir Caixa": ${resultados.botao?.botaoAbrirCaixa ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
      console.log(`   - Pre√ßo da caixa: ${resultados.preco?.precoCaixa ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
      console.log(`   - Saldo do usu√°rio: R$ ${resultados.saldo?.userData?.saldo_reais || 0}`);
      console.log(`   - Pr√™mios encontrados: ${resultados.premios?.elementosPremio?.length || 0}`);
      console.log(`   - Fun√ß√µes relevantes: ${resultados.funcoes?.funcoesRelevantes?.length || 0}`);
      console.log(`   - Eventos de clique: ${resultados.eventos?.botoesComEventos || 0}`);
      
      console.log('\nüîß PR√ìXIMOS PASSOS PARA MELHORAR O SISTEMA:');
      console.log('1. Implementar d√©bito autom√°tico ao clicar em "Abrir Caixa"');
      console.log('2. Implementar valida√ß√£o de saldo suficiente');
      console.log('3. Implementar sistema de cr√©dito ap√≥s mostrar pr√™mio');
      console.log('4. Implementar feedback visual durante o processo');
      console.log('5. Implementar tratamento de erros');
      
      // Salvar resultados para an√°lise
      window.analiseDetalhadaCompra = resultados;
      console.log('\nüíæ Resultados salvos em window.analiseDetalhadaCompra');
      
    }, 3000);
    
  } catch (error) {
    console.error('‚ùå Erro durante a an√°lise detalhada:', error);
  }
}

// ===== EXECUTAR AN√ÅLISE =====
console.log('üîç AN√ÅLISE DETALHADA DO FLUXO DE COMPRA PRONTA!');
console.log('üìã Execute: executarAnaliseDetalhada()');
console.log('üí° Certifique-se de estar em uma p√°gina de caixa espec√≠fica');

// Executar automaticamente
executarAnaliseDetalhada();
